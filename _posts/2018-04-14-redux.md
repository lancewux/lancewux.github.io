<h1 align="center"> Redux </h1>

官方文档：https://redux.js.org/introduction/core-concepts

action是一个描述发生了什么的纯对象，属性type指明类型，比如：

```
{ type: 'ADD_TODO', text: 'Go to swimming pool' }
```

Action Creators是生产action的函数，

```
function addTodo(text) {
  return {
    type: 'ADD_TODO',
    text
  }
}
dispatch(addTodo('some_text'))
```

bound action creator是自动dispatch的Action Creators

```
const boundAddTodo = text => dispatch(addTodo(text))
boundAddTodo('some_text')
```

reducer把state和action连接起来，形式为  (preState, action) => newState

```
function visibilityFilter(state = 'SHOW_ALL', action) {
  if (action.type === 'SET_VISIBILITY_FILTER') {
    return action.filter
  } else {
    return state
  }
}
function todos(state = [], action) {
  switch (action.type) {
    case 'ADD_TODO':
      return state.concat([{ text: action.text, completed: false }])
    default:
      return state
  }
}
function todoApp(state = {}, action) {
  return {
    todos: todos(state.todos, action),
    visibilityFilter: visibilityFilter(state.visibilityFilter, action)
  }
}
```

combineReducers() 的作用是合并子reducer

```
import { combineReducers } from 'redux'
const todoApp = combineReducers({
  visibilityFilter,
  todos
})
export default todoApp
```

等同于

```
export default function todoApp(state = {}, action) {
  return {
    visibilityFilter: visibilityFilter(state.visibilityFilter, action),
    todos: todos(state.todos, action)
  }
}
```

全局只有一个store和一个reducer，拆分的多个reducer要合并成一个reducer。

store的作用包括：

- 维护app的 state；
- 提供 getState() 方法获取 state；
- 提供 dispatch(action) 方法更新 state；
- 通过 subscribe(listener) 注册监听器;
- 通过 subscribe(listener) 返回的函数注销监听器。

```
import { createStore } from 'redux'
import todoApp from './reducers'
import { addTodo } from './actions'
​
const store = createStore(todoApp)
// Log the initial state
console.log(store.getState())
// Every time the state changes, log it
// Note that subscribe() returns a function for unregistering the listener
const unsubscribe = store.subscribe(() =>
  console.log(store.getState())
)
// Dispatch some actions
store.dispatch(addTodo('Learn about actions'))
// Stop listening to state updates
unsubscribe()
```

Async Actions是异步和有副作用的action

异步请求的过程分为多个阶段，每个阶段都需要改变state，所以需要dispatch相应的action。

使用Redux Thunk middleware来使用synchronous action creators。action creator
应该返回一个thunk函数，这个函数会被中间件执行。
```
// Meet our first thunk action creator!
// Though its insides are different, you would use it just like any other action creator:
// store.dispatch(fetchPosts('reactjs'))
​
export function fetchPosts(subreddit) {
  // Thunk middleware knows how to handle functions.
  // It passes the dispatch method as an argument to the function,
  // thus making it able to dispatch actions itself.
​
  return function (dispatch) {
    // First dispatch: the app state is updated to inform
    // that the API call is starting.
​
    dispatch(requestPosts(subreddit))
​
    // The function called by the thunk middleware can return a value,
    // that is passed on as the return value of the dispatch method.
​
    // In this case, we return a promise to wait for.
    // This is not required by thunk middleware, but it is convenient for us.
​
    return fetch(`https://www.reddit.com/r/${subreddit}.json`)
      .then(
        response => response.json(),
        // Do not use catch, because that will also catch
        // any errors in the dispatch and resulting render,
        // causing a loop of 'Unexpected batch number' errors.
        // https://github.com/facebook/react/issues/6895
        error => console.log('An error occurred.', error)
      )
      .then(json =>
        // We can dispatch many times!
        // Here, we update the app state with the results of the API call.
​
        dispatch(receivePosts(subreddit, json))
      )
  }
}
```

调用

```
import thunkMiddleware from 'redux-thunk'
import { createLogger } from 'redux-logger'
import { createStore, applyMiddleware } from 'redux'
import { selectSubreddit, fetchPosts } from './actions'
import rootReducer from './reducers'
​
const loggerMiddleware = createLogger()
​
const store = createStore(
  rootReducer,
  applyMiddleware(
    thunkMiddleware, // lets us dispatch() functions
    loggerMiddleware // neat middleware that logs actions
  )
)
​
store.dispatch(selectSubreddit('reactjs'))
store
  .dispatch(fetchPosts('reactjs'))
  .then(() => console.log(store.getState()))
```

